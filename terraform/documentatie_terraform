DocumentaÈ›ie:Terraform cu LocalStack
ğŸ”¹ 1. Obiectiv

Este folosit pentru crearea infrastructurii necesare rulÄƒrii unei aplicaÈ›ii simple, folosind Terraform È™i simularea serviciilor AWS prin LocalStack.

Infrastructura include:

un bucket S3 pentru stocarea datelor proiectului;

o cheie SSH;
o instanÈ›Äƒ EC2;
salvarea fiÈ™ierului de stare Terraform Ã®ntr-un bucket S3.

ğŸ”¹ 2. Structura proiectului
terraform/
â”œâ”€â”€ backend.tf      # Configurare backend S3 pentru stocarea stÄƒrii
â”œâ”€â”€ main.tf         # Provider AWS + resursele EC2, S3, SSH key

ğŸ”¹ 3. Configurarea backend-ului S3 (backend.tf)
terraform {
  backend "s3" {
    bucket = "tf-state-bucket"
    key    = "terraform.tfstate"
    region = "us-east-1"

    endpoints = {
      s3 = "http://localhost:4566"
    }

    access_key                  = "test"
    secret_key                  = "test"
    skip_credentials_validation = true
    skip_metadata_api_check     = true
    use_path_style              = true
  }
}


â¡ï¸ FiÈ™ierul de stare Terraform este salvat Ã®n bucket-ul tf-state-bucket din LocalStack.
Bucket-ul a fost creat manual folosind:

aws --endpoint-url=http://localhost:4566 s3 mb s3://tf-state-bucket

ğŸ”¹ 4. Configurarea providerului È™i resurselor (main.tf)
provider "aws" {
  region                      = "eu-central-1"
  access_key                  = "test"
  secret_key                  = "test"
  skip_credentials_validation = true
  skip_requesting_account_id  = true
  skip_metadata_api_check     = true
  s3_use_path_style           = true

  endpoints {
    ec2 = "http://localhost:4566"
    s3  = "http://localhost:4566"
    iam = "http://localhost:4566"
    sts = "http://localhost:4566"
  }
}

resource "aws_s3_bucket" "project_bucket" {
  bucket = "tf-project-bucket"
}

resource "aws_key_pair" "deploy_key" {
  key_name   = "local-dev-key"
  public_key = file("~/.ssh/id_rsa.pub")
}

resource "aws_instance" "app" {
  ami           = "ami-12345678"
  instance_type = "t2.micro"
  key_name      = aws_key_pair.deploy_key.key_name
}



ğŸ”¹ 5. IniÈ›ializare È™i rulare Terraform

PaÈ™i executaÈ›i:

cd ~/platforma-monitorizare/terraform

aws configure       # Configurare aws
    AWS Access Key ID [None]:       test
    AWS Secret Access Key [None]:   test
    Default region name [None]:     us-east-1
    Default output format [None]:   json

aws --endpoint-url=http://localhost:4566 s3 mb s3://tf-state-bucket  # Creare s3 bucket

aws --endpoint-url=http://localhost:4566 s3 ls                       # Verificare ca s3 s-a creat

rm -rf .terraform .terraform.lock.hcl       # Resetare configurare Terraform
terraform init -reconfigure                 # IniÈ›ializare cu backend S3
terraform plan                              # Verificare plan
terraform apply -auto-approve               # Creare infrastructurÄƒ

ğŸ”¹ 6. Verificarea resurselor create:

aws --endpoint-url=http://localhost:4566 s3 ls
aws --endpoint-url=http://localhost:4566 ec2 describe-instances
aws --endpoint-url=http://localhost:4566 ec2 describe-key-pairs

ExplicaÈ›ie: EC2 È™i Key Pair sunt mocked Ã®n LocalStack, deci AWS CLI nu le aratÄƒ. Terraform Ã®nsÄƒ le considerÄƒ create, fiind suficiente pentru test local È™i documentare.

Verificare state Terraform
    terraform state list
AratÄƒ cÄƒ Terraform È™tie cÄƒ resursele existÄƒ, chiar dacÄƒ CLI LocalStack nu le afiÈ™eazÄƒ.

